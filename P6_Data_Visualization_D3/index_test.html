<!DOCTYPE html>
<meta charset="utf-8">

<body>
        <link rel="stylesheet" href="css/style.css">
        <script src="//d3js.org/d3.v3.min.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <script>

            // http://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922
          
            var mapWidth = 350,
                mapHeight = 350;
          
            var c10 = d3.scale.category10();

            var projection = d3.geo.albers();

            var path = d3.geo.path()
                .projection(projection);

            var svg = d3.select("body").append("svg")
                .attr("width", mapWidth)
                .attr("height", mapHeight);
          
            var mapLabel = svg.append("text")
                .attr("y", 20)
                .attr("x", 0)
                .attr("class", "map_neighbourhood_name")

            // load TopoJSON file
            d3.json("data/toronto_topo.json", function(error, toronto) {
              if (error) throw error;

              var neighbourhoods = topojson.feature(toronto, toronto.objects.toronto); //,
//                   neighbourhood = neighbourhoods.features.filter(function(d) { return d.properties.id == 97; })[0];

              // set default projection values 
              projection
                  .scale(1)
                  .translate([0, 0]);

              // creates bounding box and helps with projection and scaling
              var b = path.bounds(neighbourhoods),
                  s = .95 / Math.max((b[1][0] - b[0][0]) / mapWidth, (b[1][1] - b[0][1]) / mapHeight),
                  t = [(mapWidth - s * (b[1][0] + b[0][0])) / 2, (mapHeight - s * (b[1][1] + b[0][1])) / 2];

              // set project with bounding box data
              projection
                  .scale(s)
                  .translate(t);
              
              // get individual neighbourhoods
              svg.selectAll("path")
                    .data(neighbourhoods.features)
                  .enter().append("path")
                    .attr("class", "map_neighbourhood")
                    .attr("d", path)
                    .on("mouseover", mouseover) 
                    .on("mouseout", mouseout)
                    .on("click", clicked)

              svg.append("path")
                  .datum(topojson.mesh(toronto, toronto.objects.toronto, function(a, b) { return a !== b; }))
                  .attr("class", "map_mesh")
                  .attr("d", path);

//              svg.append("path")
//                  .datum(neighbourhood)
//                  .attr("class", "map_outline")
//                  .attr("d", path)
            });
          
            function mouseover(d) {     
              mapLabel.text(d.properties.name.slice(0,-5)) // remove suffix id from name
            }
          
            function mouseout(d) {     
              mapLabel.text("")  
            }

            function clicked(d) {
              console.log(d.properties.id, d.properties.name)
              /*TODO: 
                set selected to true
                add d.id to list or dictionary
                if selected == true, remove d.id from list
                update text showing list
              */
            }

        </script>
        
    </body>
</html>