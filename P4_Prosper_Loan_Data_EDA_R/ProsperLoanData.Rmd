Delinquency at Peer-to-Peer Lender Prosper.com
========================================================
**by Jason Carter**

----

## Introduction

**What is Prosper**

Prosper, or Prosper Marketplace, is a leader in the online peer-to-peer lending industry. Borrowers create profiles and listings on [Prosper.com](https://prosper.com) request personal loans and investors, either individuals or institutions, view the listing (borrower's loan request) and decide how much to lend the borrower towards the loan. 

Interest rates are typically lower for the borrower than going to a financial institution, such as a bank. And multiple investors can contribute to one borrower's loan request, limiting the overall risk impact of the borrower defaulting on the loan for any one investor.

**Why Prosper Loan Data**

I've personally never used peer-to-peer lending, as a borrower or investor, but I find the idea quite intriguing from a borrower and an investor standpoint. Lower interest rates and the ability to get a loan for "small" items is the obvious pro for borrowers. But for an investor portfolio diversification and higher or less risky investment only holds true if borrower's don't default on their loans. So what are the deliquincy rates? Is there any main contributing factor? Is there any coorelation between where someone lives, their income, the purpose of their loan and defaulting on their loan? Deliquincies and their coorelation at Prosper.com is what we'll be exploring.

> Delinquent is the failure to accomplish what is required by law or duty, such as the failure to make a required payment or to perform a certain action.
>
> The term delinquent commonly refers to a situation where a borrower is late or overdue on a payment, such as income taxes, a mortgage, automobile loan or credit card account. 
>
> -- [Investopedia](http://www.investopedia.com/terms/d/delinquent.asp)


## Data Overview
The Prosper loan dataset was provided by Udacity as part of their [Data Set Options](https://docs.google.com/document/d/1qEcwltBMlRYZT-l699-71TzInWfk4W9q5rTCSvDVMpc/pub?embedded=true)

From Udacity

*This data set contains 113,937 loans with 81 variables on each loan, including loan amount, borrower rate (or interest rate), current loan status, borrower income, borrower employment status, borrower credit history, and the latest payment information.*

Dataset was last updated 03/11/2014

### Process
Overall plan on data exploration - say something here

1. load libraries
2. load data
3. summary look
4. univariate plot+analysis
5. bivariate plot+analysis
5. multivariate plot+analysis
6. final plots
7. reflection

With 81 variables, it would be useful to indicate which ones you'll send time looking at. 
Performed an initial review of all [variables definitions](https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit) and determined a list of 15-ish variables which will be required either directly or indirectly for the exploration.

#### Main Features of Interest

After reviewing the long list of variables, and thinking of all of the different paths of investigation, I've decided to narrow my focus of investigation around deliquencies and their correlations. To this end, the main features of interest are:

* **Term**: The length of the loan expressed in months.
* **LoanStatus**: The current status of the loan.
    - Cancelled
    - Chargedoff
    - Completed
    - Current
    - Defaulted
    - FinalPaymentInProgress
    - PastDue (the PastDue status will be accompanied by a delinquency bucket)
* **BorrowerState**: The two letter abbreviation of the state of the address of the borrower at the time the Listing was created.
* **ListingCategory**: The category of the listing that the borrower selected when posting their listing.
    - 0 - Not Available
    - 1 - Debt Consolidation
    - 2 - Home Improvement
    - 3 - Business
    - 4 - Personal Loan
    - 5 - Student Use
    - 6 - Auto
    - 7- Other
    - 8 - Baby&Adoption
    - 9 - Boat
    - 10 - Cosmetic Procedure
    - 11 - Engagement Ring
    - 12 - Green Loans
    - 13 - Household Expenses
    - 14 - Large Purchases
    - 15 - Medical/Dental
    - 16 - Motorcycle
    - 17 - RV
    - 18 - Taxes
    - 19 - Vacation
    - 20 - Wedding Loans
* **CreditScoreRangeLower**: The lower value representing the range of the borrower's credit score as provided by a consumer credit rating agency.
* **CreditScoreRangeUpper**: The upper value representing the range of the borrower's credit score as provided by a consumer credit rating agency. 
* **BankcardUtilization**: The percentage of available revolving credit that is utilized at the time the credit profile was pulled.
* **IncomeRange**: The income range of the borrower at the time the listing was created.
* **LoanOriginalAmount**: The origination amount of the loan.
* **Investors**: The number of investors that funded the loan.

#### Supporting Features

Below are a list of supporting features. These features will not be the source of my main investigation but will certainly help to contribute to deeper dives and identification of possible trends.

* **ListingCreationDate**: The date the listing was created.
* **Occupation**: The Occupation selected by the Borrower at the time they created the listing.
* **IsBorrowerHomeowner**: A Borrower will be classified as a homowner if they have a mortgage on their credit profile or provide documentation confirming they are a homeowner.
* **BorrowerAPR**: The Borrower's Annual Percentage Rate (APR) for the loan.
* **BorrowerRate**: The Borrower's interest rate for this loan. 
* **Recommendations**: Number of recommendations the borrower had at the time the listing was created.
* **TotalProsperLoans**: Number of Prosper loans the borrower at the time they created this listing. This value will be null if the borrower had no prior loans.
* **DebtToIncomeRatio**:
* **StatedMonthlyIncome**:


```{r echo=FALSE, message=FALSE, warning=FALSE, Packages_and_Data}
library(ggplot2) 
library(dplyr)
library(maps)
library(mapproj)
library(gridExtra)
library(GGally)

# Load the Data
pld <- read.csv("prosperLoanData.csv")
```

## Exploratory Analysis
### Univariate analysis 

First, I want to review some basics values and descriptive statistics of the dataset. This is for two main reasons, 1) to verify some values put forward by Udacity, such as the 81 variables and 113,937 observations. And 2) to determine if there is anything "weird" or "stands out" about the data which I may want to dive deeper into. Although I have a general direction, i.e deliquencies and their correlations, if something interesting pops up from the descriptive stats, I'll take a peek in that direction as well. 

Lets take a look at the dataset and verify the dimensions
```{r echo=FALSE, message=FALSE, warning=FALSE, dataset_dimensions}
# Investigate dataset dimensions
dim(pld)
```

Now I setup the new dataframe by keeping only the main and support variables.

Column "ListingCategory" is actually labelled "ListingCategory..numeric." as its column value, numeric, is mapped to a string one word description/category.

```{r echo=FALSE, message=FALSE, warning=FALSE, Create_Dataframe_Subsets}
# Review column name to fix subset() issue
names(pld[17])

# List of variables to keep
colsToKeep <- c("Term","LoanStatus","BorrowerState","ListingCategory..numeric.",
               "CreditScoreRangeLower","CreditScoreRangeUpper","BankcardUtilization","IncomeRange",
               "TotalProsperLoans","LoanOriginalAmount", "Investors","ListingCreationDate",
               "Occupation","IsBorrowerHomeowner","BorrowerAPR","BorrowerRate",
               "Recommendations","DebtToIncomeRatio", "StatedMonthlyIncome")

# Keep only variables in colsToKeep (columns to keep)
prosperloans <- subset(pld, select=colsToKeep)

str(prosperloans)
```

There are a few categorical features in the new dataset. At first glance, BorrowerState has 52 states or levels and Occupation has 68 levels/categories for over 113k observations - it should be possible to nicely group by occupations to see any trends.

Example of categorical values in "LoanStatus"
```{r echo=FALSE, message=FALSE, warning=FALSE, LoanStatus_Categories}
# Review LoanStatus cateogories
levels(prosperloans$LoanStatus)
```

There are a few challenges here. If I'm investigating delinquencies, I need to define a definition for it, and since the Prosper data has a few categories that could cover this, I need to do two things 1) learn the difference between Chargedoff and Defaulted and 2) assign a cutoff line for delinquents, i.e if someone is 1-15 days late on payment is that delinquent? What about 61-90 days late?

Chargedoff: 

> A charge-off or chargeoff is the declaration by a creditor (usually a credit card account) that an amount of debt is unlikely to be collected. This occurs when a consumer becomes severely delinquent on a debt. Traditionally, creditors will make this declaration at the point of six months without payment. In the United States, Federal regulations require creditors to charge-off installment loans after 120 days of delinquency, while revolving credit accounts must be charged-off after 180 days
>
> -- [Wikipedia](https://en.wikipedia.org/wiki/Charge-off)

Defaulted: 

> In finance, default is failure to meet the legal obligations (or conditions) of a loan,[1] for example when a home buyer fails to make a mortgage payment, or when a corporation or government fails to pay a bond which has reached maturity.
>
> -- [Wikipedia](https://en.wikipedia.org/wiki/Default_(finance)

```{r, message=FALSE, warning=FALSE, Create_Delinquent_Variable}
# New variable to be used to identify "delinquent" borrowers
prosperloans$DelinquentBorrowers <- ifelse(prosperloans$LoanStatus == "Defaulted" |
                                            prosperloans$LoanStatus == "Chargedoff" |
                                            prosperloans$LoanStatus == "Past Due (61-90 days)" |
                                            prosperloans$LoanStatus == "Past Due (91-120 days)" |
                                            prosperloans$LoanStatus == "Past Due (>120 days)", 1, 0)
```

Before going too far, I was curious as to the creation date distribution of observations in the dataset. This is important as this could cause bias in further investigation, for example, if the majority of the data was observed during 2008-2009 [(the financial crisis)](https://en.wikipedia.org/wiki/Financial_crisis) this could skew the data towards having a majority of delinquency. To analysis this, I'm going to explore the ListingCreationDate feature along with LoanStatus.

```{r echo=FALSE, message=FALSE, warning=FALSE, Creation_Year_Distribution}
# Create new variable 
prosperloans$LoanCreationYear <- format(as.Date(prosperloans$ListingCreationDate), "%Y")

# Investigate distribution of loan creation year
ggplot(prosperloans, aes(prosperloans$LoanCreationYear, fill = factor(DelinquentBorrowers))) + 
  geom_bar() +
  theme_minimal()
```

Inorder to help faciliate this more easily, I've decided to create a new variable which will capture the year segment of the loan creation date.

From first glance, there is an obvious dip in borrowers, both delinquent and otherwise across 2008 and 2009. My first thoughts were connecting this fall in borrowers to the finanical crisis which occurred in late 2008. Howwever, remember, this is loan "creation" date, and on a side note, is a good lesson in understanding the data and miss-communication in visuals. 

This data is not representing delinquent loans of 2008-9 but loans which went delinquent at some point in time that were created in 2007/8. I believe it can be assumed this is a lead up to the financial crisis, i.e. borrowers took out loans at a "normal" rate from 2006-2008 but potentially after the financial crisis in 2008, borrowers could no longer cover their monthly payments and loans created 2006-2008 were the most succeptable to defaults. 

This assumption also explains the dip in 2009 and gradual increase over the next few subsequent years, less borrowers and much fewer delinquents in comparison to the level of loans in good standing.

Time to further the analysis and investigate some other interesting features. Leaning towards investigating the relationship of borrowers and delinquency, I will do a deeper dive into: Term, LoanStatus, LoanOriginalAmount, Income Range, Borrower's State and Listing Category (the reason for a loan).

**Term and Loan Status**

```{r echo=FALSE, message=FALSE, warning=FALSE, Term_LoanStatus_Plots}
# Summary of loan terms
summary(prosperloans$Term)

# Plot defaulted terms and their loan status distribution
ggplot(prosperloans,aes(Term, fill = factor(DelinquentBorrowers))) + 
  geom_bar(width = 12) +
  scale_x_continuous(breaks = c(0,12,36,60)) + 
  theme_minimal()
```

From the summary breakdown, the average term appears to be 36 months (3 yrs) with an original loan request being $8337, ranging from $1000 to 35000. This seems to cover the full available range allowed by Prosper, although at the time of writting this analysis, Prosper now has a minimum loan limit of $2000. And what seems like a surprising amount, on average loans have 80 investors.

It's also very clear that the majority of borrowers choose a 36 month term, where 60 and then 12 month terms are 2nd and 3rd most popular, respectively. And approximately 15% of the total borrowers are delinquent on their loans. Thinking of the distribution of delinquency arcoss terms, one would imagine larger term equates to a larger loan amount and monthly payments which may be too much to handle for some. This inturn would contribute to having more delinquncies. However, the distribution of delinquency is surprisingly very similar to that of the total loan distribution across loan terms. An investigation around loan amounts and across terms may reveal more, i.e if loans with larger amounts are associated to the borrowers with better credit scores, it's more likely that these loans will be paid off and borrowers will be in good standing.

**Original Loan Amount**

```{r echo=FALSE, message=FALSE, warning=FALSE, Loan_and_Delinquents}
# Summary of loan terms
summary(prosperloans$LoanOriginalAmount)

# Plot loan terms
g <- ggplot(prosperloans,aes(LoanOriginalAmount, fill = factor(DelinquentBorrowers))) +
  theme_minimal()

g + geom_histogram(binwidth = 500)  

```

Summary data indicates mean and median quite far apart. This is visualized in the graph which is right skewed graph. As it the spikes of borrowers at $10,000, $15,000 and $25,000 are pulling the mean higher. Although, it's not particularly surprising that borrowers gravitate to these "nice" numbers. 

```{r echo=FALSE, message=FALSE, warning=FALSE, Loan_and_Delinquents_with_Breaks}
# Zoom in to get details with reduced binwidth and added breaks
g + geom_histogram(binwidth = 100) + 
    scale_x_continuous(limits = c(500, quantile(prosperloans$LoanOriginalAmount, 0.95)),
                       breaks = c(0, 2500, 5000, 7500, 10000, 12500, 15000, 17500, 20000)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Taking a closer look at 95% of the data, specifically under $20,000, you can see multiple spikes at these "nice" numbers - 1000, 2000,...,8000, 9000, 10000 - dollars. Since most debt doesn't come in nice round numbers, we can assume borrowers are probably rounding up instead to requesting exact dollar values for their loans. For example, if a borrower is $4678.86 dollars in debt, she is probably requesting a loan of $5000.00. From the data provided, I don't believe there is in specific way to determine if this assumption is true, however, given that debt / money is a floating value with interest rate applied as floating value, it is quite unlikely that the majority of borrowers have debt divisible by 5.

**Income Range**

```{r message=FALSE, warning=FALSE, IncomeRange_Distribution}
# Plot out income range of all borrowers
positions <- c("Not employed", "$0", "Not displayed", 
                "$1-24,999", "$25,000-49,999", "$50,000-74,999",
                "$75,000-99,999", "$100,000+")

ggplot(prosperloans, aes(IncomeRange)) + 
  scale_x_discrete(limits = positions) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  geom_bar()
```

Reviewing income range allows us to see the distribution of total borrowers and their income with a $25k dollar bin / range. This could shine light into the fincanical standing of borrowers which may be contributing factors to delinqunency. 

The distribution of borrowers across income range is somewhat normal if we consider that there are a number of users in the "Not Displayed" category, which was re-odered with the assumption that this category of borrowers do indeed have an income. 

TODO: mean range

**Borrowers State**

```{r echo=FALSE, message=FALSE, warning=FALSE, US_Map_of_Borrowers}
ggplot(na.omit(prosperloans),aes(BorrowerState, fill = factor(DelinquentBorrowers))) +
  geom_bar(position = "dodge") +
  scale_y_log10() +
  theme_minimal() +
  scale_fill_discrete(labels = c("Good Standing", "Delinquent")) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        legend.position="top", 
        legend.title=element_blank())

# Map the 2 letter abbrievations to their full name for map plot
prosperloans$BorrowerStateFullName <- tolower(state.name[match(prosperloans$BorrowerState, state.abb)])

us <- map_data("state")
states <- data.frame(state.center, state.abb)

# Group by stateName and delinquent borrowers
grp_by_state <- prosperloans %>%
  group_by(BorrowerStateFullName, BorrowerState, DelinquentBorrowers) %>%
  summarise(count = n()) %>%
  filter(DelinquentBorrowers == 1)

# Plot US map with delinquent borrower data
ggplot() + 
  geom_map(data = us, map = us,
            aes(x = long, y = lat, map_id = region, label = region),
            fill="#ffffff", color="#ffffff", size=0.15) +
  geom_map(data = na.omit(grp_by_state), map=us,
            aes(fill = count, map_id = BorrowerStateFullName),
            color = "#ffffff", size = 0.15) +
  geom_text(data = states, aes(x = x, y = y, label = state.abb, group = NULL), size = 2) +
  scale_fill_continuous(low='lightgray', high='black', guide='colorbar') +
  labs(x="Delinquent Borrowers by State", y=NULL) +
  coord_map("albers", lat0 = 39, lat1 = 45) +
  theme(panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        axis.text = element_blank())
```

Borrowers state covers 52 states, this includes Alaska and Hawaii. Representation for California is skewing the graph, unable to distinguish smaller state count and differences among states. Given California is the most populous state in the US, having a much higher count in borrowers is probably not a good indicator of a trend. To fix this and to better view any trend a log10 transformation was applied to the y axis.

CA has the highest levels but it should be taken into consideration that CA is the more populous. While Florida, Texas and the East coast follow suite. Noticably, "middle America" has the lowest levels of delinquent borrowers but this could also be due to lower levels in population, technical savvy, lower cost of living resulting in better financial situations not requiring loans, etc or a host of other reasons outside of the information the dataset provides.

ND and WY have no delinquent borrowers

**Listing Category**

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Map numbers to category
listing_category <- c("Not Available", "Debt Consolidation", "Home Improvement", "Business",
                      "Personal Loan", "Student Use", "Auto", "Other", "Baby&Adoption",
                      "Boat", "Cosmetic Procedure", "Engagement Ring", "Green Loans",
                      "Household Expenses", "Large Purchases", "Medical/Dental", "Motorcycle",
                      "RV", "Taxes", "Vacation", "Wedding Loans")

# Create new variable for mapped names (remember vector is not 0 based indexed, starts at 1)
prosperloans$ListingCategoryFullName <- listing_category[(prosperloans$ListingCategory..numeric.)+1]

g <- ggplot(prosperloans, aes(prosperloans$ListingCategoryFullName, fill = factor(DelinquentBorrowers))) +
  geom_bar(position="dodge") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
g

# Log file will help with comparison across all categories
g + scale_y_log10()

```

Discuss

Unidentifable: Debt consolidation (could be a mix of anything), Not Available, Other, Business (maybe)...The next "real" answer is Auto and Home Improvement

The listing category values represent the purpose or reason why the borrower is requesting a loan. For example, if the value is "Auto", perhaps the borrower recently purchased an expensive car and needs $10,000 as a downpayment to lower her monthly bill.

In my observation with this plot is that, although "Debt Consolidation" is by far the most common reason borrowers require a loan, this is misleading. Debt consolidation removes the specificity of where the debt came from, i.e. Auto, Student Use, Taxes could have equally contributed to someone's debt but the "reason" the borrower is requesting a loan is for consolidation and therefore they flag "Debt Consolidation" as the purpose. One thing we can take away from the high volume of borrowers requesting debt consolidation loans, is that, many borrowers have debt from multiple sources. 


### Bivariate analysis
Continuing to look for trends in delinquency, I will investigate possible expected and unexpected relationships between features with scatterplot and by measuring thier coorelation (pearson / spearman / rho).

* listingCategory and loanOriginalAmount (need to map listing to values)
* bankcardUtilization and loanStatus
* borrowerRate and loanStatus
* loanStatus and investors (are you more likely to default if you have less investors? investors think you're a good bet to payoff your loan so more people invest in you. This would imply that having fewer investors mean people tend to believe you are a bad investment - more likely to default. Is this true?)

* Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?
* Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?
* What was the strongest relationship you found?

**Listing Cateogry and Loan Amount**

loan amount for different categories. How to compare this with delinquent loans???
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(prosperloans, aes(ListingCategoryFullName, LoanOriginalAmount, group = ListingCategoryFullName)) +
  geom_boxplot() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Discuss - mean, debt consolidation outliers, max loan amount, baby/adoption and debt consolidation are surprising similar plots

**Loan Term and Loan Amount**

```{r echo=FALSE, message=FALSE, warning=FALSE}
# look into outliers and discrete x axis on correct terms
ggplot(prosperloans, aes(Term, LoanOriginalAmount, group = Term)) +
  geom_boxplot() +
  scale_x_continuous(breaks = c(0,12,36,60)) +
  theme_minimal()
```


**Interest Rate and Listing Category**

Is there a relationship between what rate someone gets and their reason for a loan
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(prosperloans, aes(ListingCategoryFullName, BorrowerRate, group = ListingCategoryFullName)) +
  geom_boxplot() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Discuss - person loans has the lower mean APR, debt consolidation, boat and baby loans have similar mean APRs

**remember to bring it back to delinquency**

**loan and bankcard utilization**

```{r echo=FALSE, message=FALSE, warning=FALSE}
# laon, bankcard and loan status (factor)
ggplot(prosperloans, aes(LoanOriginalAmount, BankcardUtilization)) +
  geom_point(alpha = 1/50) +
  theme_minimal() +
  scale_y_log10()
```

Discuss - over 7k borrowers with NA utilization and values over 1 (100% utilization) which I'm not sure how that was calculated. Even for lower loan amounts there is a high card utilization 

**Debt-to-Income Ratio**

```{r echo=FALSE, message=FALSE, warning=FALSE, Income_and_Debt_Ratio}
# monthly income vs debt to income ratio, highlighting delinquent borrowers
ggplot(prosperloans, aes(StatedMonthlyIncome, DebtToIncomeRatio, colour = factor(DelinquentBorrowers))) +
  geom_point(alpha = 0.1) +
  theme_minimal() +
  scale_x_continuous(limits = c(0,20000)) +
  scale_y_continuous(limits = c(0, 1)) +
  scale_color_discrete(labels = c("Good Standing", "Delinquent")) +
  geom_density2d()
```

In comparing debt-to-income ratio with a borrower's stated monthly income, I was expecting to see a, somewhat obvious, trend that delinquent borrowers would have a lower monthly income and a higher debt-to-income ratio. With overplotting in the scatterplot two additional techniques were used to more clearly reveal any trends or unexpected results.

Borrwers with stated incomes over $20k and debt-to-income ratios over 1 were considered as outliers and removed from the plot. 

The density contour lines show a high concentration of delinquent borrowers earn less than $2500 a month but have a relatively low debt-to-income ratio of under 0.25 (or 25%). The plot also suggests a negative correlation between monthly income and debt-to-income ratio, i.e the more a borrower makes in monthly income the lower their debt-to-income ratio; However, this does not guarantee the loan will not go into delinquency.

```{r echo=FALSE, message=FALSE, warning=FALSE, Rate_and_Debt_Ratio}
# names(prosperloans)
ggplot(prosperloans, aes(BorrowerRate, DebtToIncomeRatio)) +
  geom_point(alpha = 0.01) +
  scale_y_log10() +
  scale_x_continuous(limits = c(0,0.4)) +
  theme_minimal()
```

The relationship between a borrower's interest rate (BorrowerRate) and their debt ratio (DebtToIncomeRatio) was expected to be a positive correlation. I expected borrowers with high debt-to-income ratios would automatically receive higher interest rates on their loans. However, based on the above scatterplot, there seems to be no trend and a weak positive correlation between these two variables. Further investigation when plotting a correlation matrix will expose the details.

### Multivariate Analysis

In this section, I'll dive into examining the relationships between multiple variables of the dataset. There are some expected "strong" relationships which will be investigated but also any unusual or unexpected relationships ,strong or weak, will also be called out for a deep dive into the details.

First, to start with, a correlation matrix will be calculated and used in order to help start the investigation process where by the variables with strong and/or weak relationships will be reviewed.

**Correlation Matrix**

```{r message=FALSE, warning=FALSE, Correlation_Matrix}
# Pearson correlation coefficients, using pairwise observations (default method)
# Non-numeric columns automatically removed/ignored
ggcorr(prosperloans, label = TRUE, label_size = 3, hjust = 0.8, size = 2.5, color = "black", layout.exp = 2)
```

The correlation matrix revealed a few surprising things - I thought there would be a much stronger relationship between interest rate (BorrowerRate) and the credit score (CreditScoreRangeUpper/Lower). At a score of -0.5 it's the strongest correlation out of the selected variables. Also, the number of investors (Investors) and the borrower loan amount (LoanOriginalAmount) has a positive correlation of 0.4, which was somewhat expected as investors are only allowed to contribute a partion of a loan amount, i.e. no one investor can lend an entire loan amount.

Below, a few particularly interesting relationships will be investigated further.

**Credit Score and Borrowing Rate**

```{r echo=FALSE, message=FALSE, warning=FALSE, CreditScore_and_BorrowerRate}
ggplot(prosperloans, aes(CreditScoreRangeUpper, BorrowerRate,
                               color = factor(DelinquentBorrowers))) +
  scale_x_continuous(limits = c(400, 1000)) +
  scale_y_continuous(limits = c(0, 0.4)) +
  geom_point(alpha = 0.01) +
  geom_jitter() +
  scale_color_discrete(labels = c("Good Standing", "Delinquent")) +
  theme_minimal() +
  theme(legend.position="top", 
        legend.title=element_blank())
```

We see an expected result here, where the trend is lower credit scores tend to have higher borrowing rates and higher credit scores obtaining a lower borrowing rate. Delinquent borrowers also tend to have lower credit scores, this could be in part due to their higher interest rates on loan hendering payments but more investigation would be required to come to a conclusion. And also as expected, borrowers with higher credit scores and lower interest rate, tend to be in good standing with their loans.

**Credit Score and Loan Amount**

```{r echo=FALSE, message=FALSE, warning=FALSE, CreditScore_and_LoanAmount}
g1 <- ggplot(subset(prosperloans, DelinquentBorrowers == 1), 
             aes(CreditScoreRangeUpper, LoanOriginalAmount)) +
  ggtitle("Delinquent Borrowers") +
  geom_point(alpha = 0.1) +
  scale_x_continuous(limits = c(400, 1000)) +
  scale_y_continuous(limits = c(0, 35000)) +
  theme_minimal()

g2 <- ggplot(subset(prosperloans, DelinquentBorrowers == 0), 
             aes(CreditScoreRangeUpper, LoanOriginalAmount)) +
  ggtitle("Good Standing Borrowers") +
  geom_point(alpha = 0.1) +
  scale_x_continuous(limits = c(400, 1000)) +
  scale_y_continuous(limits = c(1000, 35000)) +
  theme_minimal()

grid.arrange(g1, g2, nrow = 1)

summary(prosperloans$CreditScoreRangeUpper)
```

In the above comparisons, both scatterplots show a borrower's credit score against their loan amounts. Once again, this plot reveals some expected and unexpected results. 

The higher concentration of delinquent borrowers have lower credit scores, and they also tend to borrow less money, under $10,000. This maybe due to our previous plot which indicates, lower credit scores often tend to have higher interest rates on their loans - this was an expected result. What was a bit unexpected was the lower loan amount for borrowers with much higher credit scores. Based on previous plots, higher scores provide lower rates, which would tent to allow the borrower to gain access to a higher loan amount. And although the average loan amount for loans in good standing are higher, there is still a high concentration of loans under $20,000 and with credit scores over 700. One other "weird" result which I've ignored so far has to do with the credit score values, for example, some borrowers have score of 899 where credit scores range only between 300 and 850.

**Loan Amount and Investors**

```{r echo=FALSE, message=FALSE, warning=FALSE, LoanAmount_and_Investors}
# Plot loans and investors
ggplot(prosperloans, aes(LoanOriginalAmount, Investors)) +
  geom_point(alpha = 0.1) +
  scale_x_log10() +
  theme_minimal()
```

Discuss -  log10, positive correlation, investor can investor up to 10% of their net worth (Prosper.com), expected results

**Bankcard Utilization and Borrowing Rate**

```{r echo=FALSE, message=FALSE, warning=FALSE, BorrowerRate_and_BankcardUtilization}
# Loan rates and bankcard utilization as a percentage 
ggplot(prosperloans, aes(BorrowerRate, BankcardUtilization)) + 
  geom_point(alpha = 0.1) +
  scale_y_continuous(limits = c(0, 1.5), labels = scales::percent) +
  facet_grid(DelinquentBorrowers ~ .) +
  theme_minimal()
```

It was unexpected to see bankcard utilization over 1 or 100% and how the typical calculation happens doesn't seem to allow a utilization of over 100%. Another unexpected result, was the large number of borrowers with high bankcard utilization who were in good standing. And although there are a larger number of borrowers in good standing, in comparison to delinquent borrowers, good standing borrowers have a utilization which is more evenly spread through 0 to 100%.

```{r echo=FALSE, message=FALSE, warning=FALSE, IncomeRange_LoanAmounts_across_Years}
# Examin income range and loan amounts across years 
prosperloans <- transform(prosperloans, 
               IncomeRange = factor(IncomeRange, levels = positions, labels = positions))

ggplot(prosperloans, aes(LoanCreationYear, LoanOriginalAmount)) + 
  geom_boxplot() +
  scale_y_continuous(limits = c(0,20000)) +
  facet_grid(IncomeRange ~ .) +
  theme_minimal()
```

These were quite interesting plots, as all income ranges display the same curve (distribution across 2007 - 2014). Again, this could be a result of loans, investors and the financial crisis as mentioned previously. Also, the cateogry "not displayed" is missing data after 2008, and one can assume that possibly this category was removed as an option for users after 2008, forcing users to provide more transparency - which also could have been a side effect of the crisis. However, only in 2007 is there data for any of the other categories, which would imply that during 2005 and 2006, none of the income range categories existed (or the data was lost/not recorded).

Also of note, borrowers with $100,000+ consistently have a wider spread of loan amounts over the years. And borrowers within the categories of "$0" and "not employed" should probably be lumped together to provide more accurate information or at least, more manageable information - since by definition, you cannot be employed with $0 income but you can be, not employed, and still have income (e.g. retirees).

```{r echo=FALSE, message=FALSE, warning=FALSE, IncomeRange_LoanAmounts_Years_Delinquency}
# Comparison of delinquent and good standing borrowers
ggplot(prosperloans, aes(LoanCreationYear, LoanOriginalAmount, colour = factor(DelinquentBorrowers))) + 
  geom_boxplot() +
  scale_y_continuous(limits = c(0,20000)) +
  facet_grid(IncomeRange ~ .) +
  scale_color_discrete(name = "Borrowers", breaks = c(0,1), labels = c("Good Standing", "Delinquent")) +
  theme_minimal()
```

On a deeper dive of the same plot, loan amount by year across income range, I investigate any possible trends around delinquency and spot some neccessily any new trends but unexpected results. Particularly with borrowers who income range is over $100,000, delinquency tends to tread higher then good standing accounts, especially with loans created prior to 2008. These delinquent loans tend to have a higher min, max and mean dollar amount. This larger delinquency gap can also be seen with borrowers of the $0 income range.

```{r}

# linear regression

```


## Final Plots and Summary
### plot 1
bivariate plot

### plot 2
US map

* legend
* State.abb
* rename "count"

OR IncomeRange_LoanAmounts_Years_Delinquency

### plot 3
IncomeRange_LoanAmounts_Years_Delinquency OR linear regression 

CreditScore_and_BorrowerRate
LoanAmount_and_Investors

## Reflection

* Too many variables and ideas to dive into, had to focus and not pull in more features
* credit score and borrowing rate - is your rate a predictor or the cause? 

### References
* https://en.wikipedia.org/wiki/Charge-off
* https://en.wikipedia.org/wiki/Default_(finance)
* https://www.prosper.com/help/topics/how-to-read-a-loan-listing
* http://www.investopedia.com/terms/c/credit-utilization-rate.asp
* http://www.investopedia.com/terms/d/delinquent.asp
* http://docs.ggplot2.org
* http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3
* https://en.wikipedia.org/wiki/List_of_states_and_territories_of_the_United_States
* http://stackoverflow.com/a/29618201/1343001
* http://www.investopedia.com/ask/answers/100314/what-difference-between-interest-rate-and-annual-percentage-rate-apr.asp
* https://briatte.github.io/ggcorr

### Programming Environment
```{r}
sessionInfo()
```

