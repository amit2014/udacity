Delinquency at Peer-to-Peer Lender Prosper.com
========================================================
**by Jason Carter**

----

## Introduction

**What is Prosper**

Prosper, or Prosper Marketplace, is a leader in the online peer-to-peer lending industry. Borrowers create profiles and listings on [Prosper.com](https://prosper.com) request personal loans and investors, either individuals or institutions, view the listing (borrower's loan request) and decide how much to lend the borrower towards the loan. 

Interest rates are typically lower for the borrower than going to a financial institution, such as a bank. And multiple investors can contribute to one borrower's loan request, limiting the overall risk impact of the borrower defaulting on the loan for any one investor.

**Why Prosper Loan Data**

I've personally never used peer-to-peer lending, as a borrower or investor, but I find the idea quite intriguing from a borrower and an investor standpoint. Lower interest rates and the ability to get a loan for "small" items is the obvious pro for borrowers. But for an investor portfolio diversification and higher or less risky investment only holds true if borrower's don't default on their loans. So what are the deliquincy rates? Is there any main contributing factor? Is there any coorelation between where someone lives, their income, the purpose of their loan and defaulting on their loan? Deliquincies and their coorelation at Prosper.com is what we'll be exploring.

> Delinquent is the failure to accomplish what is required by law or duty, such as the failure to make a required payment or to perform a certain action.
>
> The term delinquent commonly refers to a situation where a borrower is late or overdue on a payment, such as income taxes, a mortgage, automobile loan or credit card account. 
>
> -- [Investopedia](http://www.investopedia.com/terms/d/delinquent.asp)


## Data Overview
The Prosper loan dataset was provided by Udacity as part of their [Data Set Options](https://docs.google.com/document/d/1qEcwltBMlRYZT-l699-71TzInWfk4W9q5rTCSvDVMpc/pub?embedded=true)

From Udacity

*This data set contains 113,937 loans with 81 variables on each loan, including loan amount, borrower rate (or interest rate), current loan status, borrower income, borrower employment status, borrower credit history, and the latest payment information.*

Dataset was last updated 03/11/2014

### Process
Overall plan on data exploration - say something here

1. load libraries
2. load data
3. summary look
4. univariate plot+analysis
5. bivariate plot+analysis
5. multivariate plot+analysis
6. final plots
7. reflection

With 81 variables, it would be useful to indicate which ones you'll send time looking at. 
Performed an initial review of all [variables definitions](https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit) and determined a list of 15-ish variables which will be required either directly or indirectly for the exploration.

#### Main Features of Interest

After reviewing the long list of variables, and thinking of all of the different paths of investigation, I've decided to narrow my focus of investigation around deliquencies and their correlations. To this end, the main features of interest are:

* **Term**: The length of the loan expressed in months.
* **LoanStatus**: The current status of the loan.
    - Cancelled
    - Chargedoff
    - Completed
    - Current
    - Defaulted
    - FinalPaymentInProgress
    - PastDue (the PastDue status will be accompanied by a delinquency bucket)
* **BorrowerState**: The two letter abbreviation of the state of the address of the borrower at the time the Listing was created.
* **ListingCategory**: The category of the listing that the borrower selected when posting their listing.
    - 0 - Not Available
    - 1 - Debt Consolidation
    - 2 - Home Improvement
    - 3 - Business
    - 4 - Personal Loan
    - 5 - Student Use
    - 6 - Auto
    - 7- Other
    - 8 - Baby&Adoption
    - 9 - Boat
    - 10 - Cosmetic Procedure
    - 11 - Engagement Ring
    - 12 - Green Loans
    - 13 - Household Expenses
    - 14 - Large Purchases
    - 15 - Medical/Dental
    - 16 - Motorcycle
    - 17 - RV
    - 18 - Taxes
    - 19 - Vacation
    - 20 - Wedding Loans
* **CreditScoreRangeLower**: The lower value representing the range of the borrower's credit score as provided by a consumer credit rating agency.
* **CreditScoreRangeUpper**: The upper value representing the range of the borrower's credit score as provided by a consumer credit rating agency. 
* **BankcardUtilization**: The percentage of available revolving credit that is utilized at the time the credit profile was pulled.
* **IncomeRange**: The income range of the borrower at the time the listing was created.
* **TotalProsperLoans**: Number of Prosper loans the borrower at the time they created this listing. This value will be null if the borrower had no prior loans. 
* **LoanOriginalAmount**: The origination amount of the loan.
* **PercentFunded**: Percent the listing was funded.
* **InvestmentFromFriendsCount**: Number of recommendations the borrower had at the time the listing was created.
* **InvestmentFromFriendsAmount**: Dollar amount of investments that were made by friends.
* **Investors**: The number of investors that funded the loan.

#### Supporting Features
Supporting features...

* **ListingCreationDate**: The date the listing was created.
* **Occupation**: The Occupation selected by the Borrower at the time they created the listing.
* **IsBorrowerHomeowner**: A Borrower will be classified as a homowner if they have a mortgage on their credit profile or provide documentation confirming they are a homeowner.
* **BorrowerAPR**: The Borrower's Annual Percentage Rate (APR) for the loan.
* **BorrowerRate**: The Borrower's interest rate for this loan. 
* **Recommendations**: Number of recommendations the borrower had at the time the listing was created.


```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2) # Used making plots
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
# Load the Data
pld <- read.csv("prosperLoanData.csv")
```

## Exploratory Analysis
### Univariate analysis 
First, I want to review some basics values and descriptive statistics of the dataset. This is for two reasons, 1) to verify some values put forward by Udacity, such as the 81 variables and 113,937 observations. And 2) to determine if there is anything "weird" or stands out about the data which I may want to dive deeper into. Although I have a general direction, i.e deliquencies and their correlations, if something as or more interesting pops up from the descriptive stats, I'll take a peek in that direction as well. 

Lets take a look at the dataset and verify the dimensions
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Take a look at dataset dimensions
dim(pld)
```

Now, I setup the new data frame by keeping only the main and support variables.

Column "ListingCategory" is actually labelled "ListingCategory..numeric." as its column value, numeric, is mapped to a string one word description.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# 113,930 observations with 81 variables
# Taking a look at the column name, kept getting errror in subset()
names(pld[17])

# List of variables to keep
colsToKeep <- c("Term","LoanStatus","BorrowerState","ListingCategory..numeric.",
               "CreditScoreRangeLower","CreditScoreRangeUpper","BankcardUtilization","IncomeRange",
               "TotalProsperLoans","LoanOriginalAmount","PercentFunded","InvestmentFromFriendsCount",
               "InvestmentFromFriendsAmount","Investors","ListingCreationDate","Occupation",
               "IsBorrowerHomeowner","BorrowerAPR","BorrowerRate","Recommendations")
```

```{r}
# Created vector with columns to keep
# Select columns of main and supporting features
prosperloans <- subset(pld, select=colsToKeep)
str(prosperloans)
```

There are a few categorical features in the new dataset. At first glance, BorrowerState has 52 states or levels and Occupation has 68 levels/categories for over 113k observations - it should be possible to group by occupations to see any trends.

Example of categorical values in "LoanStatus"
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Review a LoanStatus and IsBorrowerHomeowner.
levels(prosperloans$LoanStatus)
```

Some interesting initial features to look at in regards to delinquency are: Term, LoanStatus, LoanOriginalAmount, Income Rnage and Borrower's State.

**Term and Loan Status**
```{r echo=FALSE, message=FALSE, warning=FALSE}
# summary of loan terms
summary(prosperloans$Term)

# plot loan terms
ggplot(prosperloans,aes(Term)) + 
  geom_bar(width = 12) +
  scale_x_continuous(breaks = c(0,12,36,60))

# filter out those who are >120, defaulted or chargedoff
pl.defaulted <- subset(prosperloans, 
                        LoanStatus == "Defaulted" |
                        LoanStatus == "Chargedoff" |
                        LoanStatus == "Past Due (91-120 days)" |
                        LoanStatus == "Past Due (>120 days)")

# plot defaulted terms and their loan status distribution
ggplot(pl.defaulted,aes(Term, fill = LoanStatus)) + 
  geom_bar(width = 12) +
  scale_x_continuous(breaks = c(0,12,36,60)) + 
  scale_fill_brewer(palette = "Blues")
```

From the summary breakdown, the average term appears to be 36 months (3 yrs) with an original loan request being $8337, ranging from $1000 to 35000. This seems to cover the full available range allowed by Prosper, although at the time of writting this analysis, Prosper has a minimum limit of $2000. And what seems like a surprising amount, on average these loans have 80 investors.

It's also very clear that the majority of borrowers choose a 36 month term, where 60 and then 12 month terms are 2nd and 3rd most popular, respectively. And approximately 15% of the total borrowers are delinquent on their loans. And the distribution of delinquency is not surprisingly very similar to that of the total loan distribution across loan terms.

**Original Loan Amount**
```{r echo=FALSE, message=FALSE, warning=FALSE}
# summary of loan terms
summary(prosperloans$LoanOriginalAmount)

# plot loan terms
g <- ggplot(pl.defaulted,aes(LoanOriginalAmount))
g + geom_histogram(binwidth = 500)
```

Summary data indicates mean and median quite far apart. This is visualized in the graph which is right skewed graph. As it the spikes of borrowers at $10,000, $15,000 and $25,000 are pulling the mean higher. Although, it's not particularly surprising that borrowers gravitate to these "nice" numbers. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
# zoom in to get details with reduced binwidth and added breaks
g + geom_histogram(binwidth = 100) + 
  scale_x_continuous(limits = c(500, 12000), 
                     breaks = c(1000,2000,3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000))
```

Zooming in to look at the details, specifically under $10,000, you can see multiple spikes at these "nice" numbers - 1000, 2000,...,8000, 9000, 10000 - dollars. Since most debt doesn't come in nice round numbers, we can assume borrowers are probably rounding up instead to requesting exact dollar values for their loans. For example, if a borrower is $4678.86 dollars in debt, she is probably requesting a loan of $5000.00. From the data provided, I don't believe there is in specific way to determine if this assumption is true, however, given that debt / money is a floating value with interest rate applied as floating value, it is quite unlikely that the majority of borrowers have debt divisible by 5.

**Income Range**
```{r}
# plot out income range of delinquent borrowers
# plot out income range of all borrowers

# TODO: not working

levels(prosperloans$IncomeRange) <- c("Not employed", "Not displayed", "$0", 
                                      "$1-24,999", "$25,000-49,999", "$50,000-74,999",
                                      "$75,000-99,999", "$100,000+")
ggplot(prosperloans,aes(IncomeRange)) + 
  geom_bar()
```

discuss

```{r}
ggplot(prosperloans,aes(BorrowerState)) + geom_bar() # transfrom y axis (log10 maybe?)
```

discuss

### Bivariate analysis
plots and description
* most defaulted term
* borrowerState heatmap??? defaulted count
* Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?
* Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?
* What was the strongest relationship you found?


### Multivariate Analysis

* Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?
* Were there any interesting or surprising interactions between features?
* OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

## Final Plots
### plot 1
description

### plot 2
description

### plot 3
description

## Reflection
stuff

### References
* https://en.wikipedia.org/wiki/Charge-off
* https://www.prosper.com/help/topics/how-to-read-a-loan-listing
* http://www.investopedia.com/terms/c/credit-utilization-rate.asp
* http://www.investopedia.com/terms/d/delinquent.asp
* http://docs.ggplot2.org
* http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3
